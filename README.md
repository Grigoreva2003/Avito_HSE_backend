# Backend Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
ÐšÑƒÑ€Ñ Ð¿Ð¾ Backend'Ñƒ Ð¾Ñ‚ Ð¼Ð°Ð³Ð¸ÑÑ‚ÐµÑ€ÑÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ ÐÐ˜Ð£ Ð’Ð¨Ð­ Ð² ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ðµ Ñ ÐÐ²Ð¸Ñ‚Ð¾

## ÐÐ²Ñ‚Ð¾Ñ€
Ð“Ñ€Ð¸Ð³Ð¾Ñ€ÑŒÐµÐ²Ð° Ð’Ð°ÑÐ¸Ð»Ð¸ÑÐ°, ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚ÐºÐ° Ð¼Ð°Ð³Ð¸ÑÑ‚Ñ€Ð°Ñ‚ÑƒÑ€Ñ‹ ÐÐ˜Ð£ Ð’Ð¨Ð­ Ð¤ÐšÐ Ñ… ÐÐ²Ð¸Ñ‚Ð¾ "ÐœÐ°ÑˆÐ¸Ð½Ð½Ð¾Ðµ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð² Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ð¾Ð¼ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ðµ"

## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
Ð¡ÐµÑ€Ð²Ð¸Ñ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¹ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ML-Ð¼Ð¾Ð´ÐµÐ»Ð¸ (LogisticRegression) Ð´Ð»Ñ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¹.

### ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð¿Ð¾ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñƒ **Ð¼Ð½Ð¾Ð³Ð¾ÑÐ»Ð¾Ð¹Ð½Ð¾Ð¹ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹** Ñ Ñ‡ÐµÑ‚ÐºÐ¸Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:

- **HTTP Layer** (routers/) - Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° HTTP Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð², Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ, Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- **Service Layer** (services/) - Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ†Ð¸Ð¸
- **ML Layer** (ml/) - Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ML-Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
```
â”œâ”€â”€ main.py                         # Ð¢Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° FastAPI
â”œâ”€â”€ config.py                       # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â”œâ”€â”€ database.py                     # ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº PostgreSQL 
â”œâ”€â”€ ml/                             # ML ÑÐ»Ð¾Ð¹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ model_manager.py            # ModelManager - Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ML-Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ
â”œâ”€â”€ models/                         # Pydantic Ð¼Ð¾Ð´ÐµÐ»Ð¸
â”‚   â””â”€â”€ ads.py                      # AdRequest Ð¸ PredictResponse
â”œâ”€â”€ routers/                        # HTTP ÑÐ»Ð¾Ð¹
â”‚   â””â”€â”€ ads.py                      # POST /predict - Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ð¾Ð²
â”œâ”€â”€ services/                       # Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°
â”‚   â”œâ”€â”€ exceptions.py               # Ð”Ð¾Ð¼ÐµÐ½Ð½Ñ‹Ðµ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
â”‚   â””â”€â”€ moderation.py               # ModerationService - Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ†Ð¸Ð¸
â”œâ”€â”€ repositories/                   # Data Access Layer
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ sellers.py                  # SellerRepository - CRUD Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð¾Ð²
â”‚   â””â”€â”€ ads.py                      # AdRepository - CRUD Ð´Ð»Ñ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¹
â”œâ”€â”€ db/                             # SQL Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð‘Ð”
â”‚   â”œâ”€â”€ README.md                   # Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÑÑ…ÐµÐ¼Ðµ Ð‘Ð”
â”‚   â”œâ”€â”€ V001__initial_schema.sql    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†
â”‚   â”œâ”€â”€ V002__seed_data.sql         # Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
â”‚   â””â”€â”€ migrations.yml              # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ pgmigrate
â”œâ”€â”€ tests/                          # Unit-Ñ‚ÐµÑÑ‚Ñ‹
â”‚   â”œâ”€â”€ conftest.py                 # ÐžÐ±Ñ‰Ð¸Ðµ Ñ„Ð¸ÐºÑÑ‚ÑƒÑ€Ñ‹
â”‚   â””â”€â”€ test_ads.py                 # Ð¢ÐµÑÑ‚Ñ‹ Ð´Ð»Ñ /predict
â””â”€â”€ requirements.txt                # Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Python
```

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº

### 1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
```bash
python3 -m venv venv
source venv/bin/activate  # Ð´Ð»Ñ macOS/Linux
```

### 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ PostgreSQL

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ PostgreSQL 15 (macOS)
brew install postgresql@15

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸Ñ PostgreSQL
brew services start postgresql@15

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ PostgreSQL Ð² PATH
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
```

### 3. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
cat > .env << 'EOF'
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=
DB_DATABASE=avito_moderation
DB_POOL_MIN_SIZE=10
DB_POOL_MAX_SIZE=20

APP_NAME=Avito Moderation Service
APP_VERSION=1.0.0
APP_HOST=0.0.0.0
APP_PORT=8003
APP_DEBUG=False
APP_LOG_LEVEL=INFO

ML_MODEL_PATH=model.pkl
ML_MODEL_VERSION=1.0.0
EOF
```

**Ð’Ð°Ð¶Ð½Ð¾:** 
- Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `DB_USER=postgres` Ð½Ð° Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ `whoami` Ð² Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ)
- Ð”Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð½Ð° macOS Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ (Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ `DB_PASSWORD=` Ð¿ÑƒÑÑ‚Ñ‹Ð¼)
- Ð”Ð»Ñ production ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
- Ð¤Ð°Ð¹Ð» `.env` Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ð² git


### 4. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Python

```bash
pip install -r requirements.txt
```

### 5. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
```bash
python3 main.py
```

Ð¡ÐµÑ€Ð²Ð¸Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: `http://localhost:8003` (Ð¸Ð»Ð¸ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ Ð¸Ð· `APP_PORT` Ð² `.env`)

ÐŸÑ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ:
- Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº PostgreSQL
- **ModelManager** Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ÑÑ
- ÐžÐ±ÑƒÑ‡Ð°ÐµÑ‚ÑÑ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð½Ð° ÑÐ¸Ð½Ñ‚ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
- ÐœÐ¾Ð´ÐµÐ»ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² `model.pkl` (Ð¸Ð»Ð¸ Ð² Ð¿ÑƒÑ‚ÑŒ Ð¸Ð· `ML_MODEL_PATH`)
- ÐŸÑ€Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ… Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð°

## ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ðŸ”§

Ð’ÑÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð²Ñ‹Ð½ÐµÑÐµÐ½Ñ‹ Ð² Ñ„Ð°Ð¹Ð» `.env` Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `config.py` Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ **Pydantic Settings**.

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

| Ð“Ñ€ÑƒÐ¿Ð¿Ð°           | ÐŸÑ€ÐµÑ„Ð¸ÐºÑ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ                                    |
|------------------|---------|---------------------------------------------|
| DatabaseSettings | `DB_*`  | ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº PostgreSQL          |
| AppSettings      | `APP_*` | ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (Ð¿Ð¾Ñ€Ñ‚, Ñ…Ð¾ÑÑ‚, Ð»Ð¾Ð³Ð¸)     |
| MLSettings       | `ML_*`  | ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ML-Ð¼Ð¾Ð´ÐµÐ»Ð¸ (Ð¿ÑƒÑ‚ÑŒ Ðº Ñ„Ð°Ð¹Ð»Ñƒ Ð¼Ð¾Ð´ÐµÐ»Ð¸)   |

**ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ macOS:** PostgreSQL Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¸Ð¼Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹. Ð£Ð·Ð½Ð°Ð¹Ñ‚Ðµ ÐµÐ³Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ `whoami` Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð² `DB_USER`. ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ `DB_PASSWORD` Ð¿ÑƒÑÑ‚Ñ‹Ð¼).

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² ÐºÐ¾Ð´Ðµ

```python
from config import get_settings

settings = get_settings()

# Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð‘Ð”
print(settings.database.host)          # localhost
print(settings.database.url)           # postgresql://user:pass@host:port/db
print(settings.database.async_url)     # postgresql+asyncpg://...

# Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
print(settings.app.port)               # 8003
print(settings.app.log_level)          # INFO
print(settings.app.debug)              # False

# Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð¼Ð¾Ð´ÐµÐ»Ð¸
print(settings.ml.model_path)          # model.pkl
```
## Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…

### Ð¡Ñ…ÐµÐ¼Ð° Ð‘Ð”

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ PostgreSQL Ñ Ð´Ð²ÑƒÐ¼Ñ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ð¼Ð¸:

- **sellers** (Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ‹/Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸) - Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð°Ñ…
- **ads** (Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ñ) - Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð± Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸ÑÑ…

Ð¡Ð²ÑÐ·ÑŒ: `ads.seller_id` â†’ `sellers.id` (Ð¾Ð´Ð¸Ð½ Ð¿Ñ€Ð¾Ð´Ð°Ð²ÐµÑ† Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ Ð¼Ð½Ð¾Ð³Ð¾ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¹)

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð‘Ð” Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
createdb avito_moderation

# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ñ‡ÐµÑ€ÐµÐ· pgmigrate
cd db
pgmigrate -t latest migrate
cd ..

# Ð˜Ð»Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· psql
psql avito_moderation -f db/V001__initial_schema.sql
psql avito_moderation -f db/V002__seed_data.sql

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹
psql avito_moderation -c "\dt"
psql avito_moderation -c "SELECT COUNT(*) FROM sellers;"
psql avito_moderation -c "SELECT COUNT(*) FROM ads;"
```

**Ð’Ð°Ð¶Ð½Ð¾:** Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ (Ñ…Ð¾ÑÑ‚, Ð¿Ð¾Ñ€Ñ‚, Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ), Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¸Ñ… Ð² `db/migrations.yml`.

**ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð¸Ðµ:**
- `envsubst < migrations.yml` - Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ `${DB_HOST}`, `${DB_PORT}` Ð¸ Ñ‚.Ð´. Ð¸Ð· Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
- `pgmigrate -c /dev/stdin` - Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ Ð¸Ð· stdin (ÑƒÐ¶Ðµ Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÐ¼Ð¸)

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
psql avito_moderation -c "\dt"

# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†
psql avito_moderation -c "\d sellers"
psql avito_moderation -c "\d ads"

# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
psql avito_moderation -c "SELECT * FROM sellers;"
psql avito_moderation -c "SELECT * FROM ads LIMIT 5;"
```

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ Ð¾ ÑÑ…ÐµÐ¼Ðµ Ð‘Ð” Ð¸ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÑ… ÑÐ¼. [`db/README.md`](db/README.md).

### Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸

Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð‘Ð” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸:

- **SellerRepository** (`repositories/sellers.py`) - CRUD Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð¾Ð²
- **AdRepository** (`repositories/ads.py`) - CRUD Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¹

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:

```python
from repositories import SellerRepository, AdRepository

# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð°
seller_repo = SellerRepository()
seller = await seller_repo.get_by_id(1)

# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸
ad_repo = AdRepository()
ad = await ad_repo.get_by_id(100, include_seller=True)
print(ad.seller_is_verified)  # True
```

## API

### POST /predict
ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¹ Ð² Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¸ (Ñ Ð¿Ð¾Ð»Ð½Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸).

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```json
{
  "seller_id": 1,
  "is_verified_seller": true,
  "item_id": 100,
  "name": "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°",
  "description": "ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°",
  "category": 5,
  "images_qty": 3
}
```

**ÐžÑ‚Ð²ÐµÑ‚ (200 OK):**
```json
{
  "is_violation": false,
  "probability": 0.12
}
```

**ÐšÐ¾Ð´Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:**
- `200` - Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ
- `422` - ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
- `503` - ML-Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°
- `500` - Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°

### POST /simple_predict
ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¹ Ð² Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¸ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ item_id, Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÐµÑ€ÑƒÑ‚ÑÑ Ð¸Ð· Ð‘Ð”).

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```json
{
  "item_id": 100
}
```

**ÐžÑ‚Ð²ÐµÑ‚ (200 OK):**
```json
{
  "is_violation": false,
  "probability": 0.12
}
```

**ÐšÐ¾Ð´Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:**
- `200` - Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ
- `404` - ÐžÐ±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾
- `422` - ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
- `503` - ML-Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°
- `500` - Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°

## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… Ñ‚ÐµÑÑ‚Ð¾Ð²
```bash
pytest tests/ -v
```

### Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ñ
```bash
pytest tests/test_ads.py -v
```

### Ð—Ð°Ð¿ÑƒÑÐº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²
```bash
pytest tests/test_ads.py::TestSuccessfulPredictionViolation -v
```

### Ð—Ð°Ð¿ÑƒÑÐº Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð¾Ð¼ Ð»Ð¾Ð³Ð¾Ð²
```bash
pytest tests/test_ads.py -v -s
```

### Ð¢ÐµÑÑ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð‘Ð”
```bash
# Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÑÑ‚Ñ‹ Ð‘Ð”
pytest tests/test_ads.py::TestDatabaseOperations -v

# ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹ Ð‘Ð”
pytest tests/test_ads.py -v -k "not TestDatabaseOperations"
```


## Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
Ð’ÑÐµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ INFO:
- Ð’Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ñ (is_violation, probability)
- ÐžÑˆÐ¸Ð±ÐºÐ¸ (Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ñ€Ð¾ÑƒÑ‚ÐµÑ€Ð° Ð¸ ÑÐµÑ€Ð²Ð¸ÑÐ°)

ÐŸÑ€Ð¸Ð¼ÐµÑ€:
```
INFO - Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ: seller_id=1, item_id=100, is_verified=True...
INFO - Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð´Ð»Ñ seller_id=1, item_id=100: is_violation=False, probability=0.1234
```

## ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

**Ð Ð¾ÑƒÑ‚ÐµÑ€ Ð½Ðµ Ð·Ð½Ð°ÐµÑ‚ Ð¾ Ð¼Ð¾Ð´ÐµÐ»Ð¸:**
```python
# Ð Ð¾ÑƒÑ‚ÐµÑ€ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ ÑÐµÑ€Ð²Ð¸Ñ Ð¸ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¼ÐµÑ‚Ð¾Ð´
moderation_service = ModerationService()
return moderation_service.predict_violation(ad_data)
```

**Ð¡ÐµÑ€Ð²Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ‡ÐµÑ€ÐµÐ· ÑÐ¸Ð½Ð³Ð»Ñ‚Ð¾Ð½:**
```python
# Ð¡ÐµÑ€Ð²Ð¸Ñ Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ðº ModelManager
self._model_manager = get_model_manager()
is_violation, probability = self._model_manager.predict(...)
```
